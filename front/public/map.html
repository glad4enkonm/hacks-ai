<!DOCTYPE html>
<html>
  <head>
    <title>heatlayer count example</title>
    <link rel="stylesheet" href="https://openlayers.org/en/v3.20.1/css/ol.css" type="text/css">
    <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://openlayers.org/en/v3.20.1/build/ol.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.2.61/jspdf.min.js"></script>
  </head>
  <body>
    <div id="map" class="map"></div>
    <script>
      var raster = new ol.layer.Tile({
        source: new ol.source.OSM()
      });
      
      var heatlayer = new ol.layer.Heatmap({
        source: new ol.source.Vector(),
        blur: parseInt(24),
        radius: parseInt(15)
      });
      
            var adddata = [[30.2502295,59.9012907],[30.2511227,59.9010298],[30.2529959,59.9004065],[30.2536453,59.9002229],[30.254016,59.9001698],[30.2545032,59.9002996],[30.2550207,59.9004425],[30.2556283,59.9005558],[30.2561513,59.9005716],[30.2570052,59.900495],[30.2575727,59.9003963],[30.2611487,59.8998644],[30.2621002,59.8998911],[30.262968,59.900082],[30.2646122,59.9005706],[30.2650538,59.90096],[30.2657085,59.901819],[30.26615,59.9019564],[30.2666828,59.901964],[30.2676695,59.9020115],[30.2681268,59.902092],[30.2686119,59.9022005],[30.2689758,59.9023113],[30.2690959,59.9024091],[30.269288,59.9023757],[30.2694215,59.9023548],[30.269548,59.9023345],[30.269637,59.9023163],[30.2703424,59.9021777],[30.2710687,59.9020349],[30.2713176,59.9019862],[30.2716247,59.9019269],[30.2719329,59.9018665],[30.2719736,59.9018586],[30.2725453,59.9017448],[30.2727358,59.9017071],[30.2728677,59.9016808],[30.2729147,59.9017113],[30.272967,59.9017361],[30.2730218,59.9017564],[30.2730901,59.9017773],[30.2731614,59.9017919],[30.2732405,59.9018017],[30.2733141,59.9018049],[30.2733895,59.9018034],[30.2734591,59.9017971],[30.2735274,59.9017871],[30.2735963,59.9017715],[30.273656,59.9017526],[30.2737201,59.9017268],[30.273768,59.901696],[30.2738068,59.9016667],[30.2738418,59.9016322],[30.273872,59.9015835],[30.2738823,59.9015438],[30.2738776,59.9015061],[30.2739961,59.9015009],[30.2741066,59.9014956],[30.2742053,59.9014945],[30.2742969,59.9014986],[30.2743874,59.9015116],[30.2744755,59.9015275],[30.2745826,59.9015633],[30.2758289,59.901114],[30.2763414,59.9013598],[30.276802,59.9016308],[30.2767748,59.9016446],[30.2769779,59.9017701],[30.2771023,59.9018461],[30.27724,59.9019409],[30.2774615,59.9020959],[30.2776363,59.9022725],[30.2796349,59.9033556],[30.2800151,59.9035588],[30.2801824,59.9035934],[30.2803545,59.9036369],[30.2807081,59.9037477],[30.2809136,59.9037968],[30.2811581,59.9038415],[30.2814008,59.9038761],[30.2819152,59.9039237],[30.2821248,59.903935],[30.283617,59.9038043],[30.2845809,59.9037106],[30.2866383,59.9035471],[30.2890871,59.9033022],[30.2899085,59.9032431],[30.2899133,59.903178],[30.2905912,59.9031405],[30.2907441,59.9031252],[30.2908979,59.9031098],[30.2911294,59.9031296],[30.2920476,59.903078],[30.2927639,59.9029629],[30.2930904,59.9028945],[30.2931241,59.9029252],[30.2934545,59.9028647],[30.293935,59.902771],[30.2942298,59.9027354],[30.2942624,59.9027989],[30.2946082,59.9027544],[30.2946438,59.9027466],[30.2946088,59.9026776],[30.2947606,59.9025213],[30.2949666,59.9025689],[30.2950397,59.9025016],[30.295407,59.9026035],[30.2956998,59.9023201],[30.2956591,59.9023079],[30.2956415,59.902244],[30.2955046,59.9022039],[30.2955699,59.9021427],[30.2954743,59.902116],[30.2957213,59.9018932],[30.2957365,59.9018974],[30.2957903,59.9018642],[30.2958444,59.9017993],[30.2961957,59.9018731],[30.2962863,59.9018921],[30.2965218,59.9019645],[30.2966036,59.901988],[30.2966693,59.9019901],[30.2967364,59.9019578],[30.2968544,59.9019443],[30.2968799,59.9019373],[30.2968993,59.9019077],[30.2969395,59.9017012],[30.2970058,59.9008783],[30.2970343,59.9008787],[30.2970541,59.9005573],[30.2970287,59.9003672],[30.2970086,59.9002865],[30.2969563,59.900265],[30.2967994,59.8999717],[30.2967815,59.8999404],[30.2966458,59.8996939],[30.296562,59.8995103],[30.2964923,59.8993341],[30.2964695,59.899242],[30.2964842,59.8991586],[30.2964298,59.899159],[30.2963841,59.8991595],[30.2963246,59.8989736],[30.296322,59.8989043],[30.2962925,59.8988492],[30.2961262,59.8986339],[30.2957734,59.898077],[30.2956031,59.8978187],[30.2952647,59.8972285],[30.2953136,59.8971811],[30.2951787,59.8969386],[30.2950657,59.8967739],[30.2949755,59.8965653],[30.2951139,59.8965448],[30.2949784,59.8962945],[30.2947812,59.8961229],[30.2978907,59.8960308],[30.3001883,59.8961298],[30.3004041,59.8961338],[30.3007921,59.8961409],[30.3017053,59.8961576],[30.3026068,59.8961863],[30.3036287,59.8962009],[30.3038429,59.896204],[30.3039698,59.8962058],[30.3049171,59.8962203],[30.3053317,59.8962252],[30.3054731,59.8962262],[30.3060814,59.8962359],[30.3066686,59.8962415],[30.3071234,59.8962508],[30.3072833,59.8962531],[30.3074945,59.8962561],[30.308691,59.8962732],[30.3093163,59.8962821],[30.3095353,59.8962853],[30.3098413,59.8962896],[30.3102009,59.8962901],[30.3103169,59.8962879],[30.3103967,59.896286],[30.3104693,59.8962782],[30.3105453,59.8962683],[30.3109372,59.8962726],[30.311766,59.8963166],[30.3122572,59.8963449],[30.3135967,59.8963598],[30.3137491,59.8963473],[30.3141415,59.8963513],[30.3147982,59.8963652],[30.3155095,59.8963851],[30.3166087,59.8963946],[30.3174361,59.8964046],[30.3184731,59.896417],[30.3186428,59.8964191],[30.3186863,59.8964196],[30.3190328,59.8964238],[30.3191434,59.8964251],[30.3191757,59.8964255],[30.3188175,59.9023867],[30.3186584,59.9027619],[30.3184023,59.9081949],[30.3183963,59.9085089],[30.3184052,59.9086376],[30.3195008,59.908642],[30.3201317,59.9086962],[30.3207753,59.9087756],[30.3219512,59.9091147],[30.3251527,59.9103327],[30.3325755,59.9130514],[30.3335212,59.9133749],[30.3394124,59.9155243],[30.3400813,59.9157427],[30.3401333,59.9161085],[30.3405231,59.9162781],[30.3407121,59.9163595],[30.340973,59.9164669],[30.3412088,59.9165521],[30.3412284,59.9165592],[30.3417036,59.9167288],[30.3421762,59.9169049],[30.3424982,59.9170281],[30.3426784,59.9170929],[30.3425176,59.9172244],[30.3421559,59.9175209],[30.3419737,59.9176724],[30.3417831,59.9178276],[30.3414925,59.9180717],[30.3413009,59.9182352],[30.3408075,59.9186499],[30.3406538,59.9187767],[30.3404935,59.9189075],[30.3396691,59.9195861],[30.3395413,59.9196719],[30.3393792,59.9197801],[30.3392546,59.9198724],[30.3389446,59.9201265],[30.3384844,59.9205009],[30.3383098,59.9206446],[30.3380897,59.9208258],[30.3379519,59.9209349],[30.3377953,59.9210607],[30.3371941,59.9215543],[30.3371123,59.9216252],[30.3365553,59.9220907],[30.3364728,59.9221597],[30.3363696,59.9222493],[30.3361621,59.9224251],[30.336107,59.9224643],[30.3352309,59.9233162],[30.3357858,59.9235368],[30.3304534,59.9260735],[30.3300187,59.9262994],[30.32703,59.9251507],[30.3218708,59.9285986],[30.318983,59.93053],[30.3178175,59.9313099],[30.3153107,59.9329953],[30.3118605,59.9353013],[30.3117762,59.9353581],[30.311539,59.9355176],[30.3114609,59.9355701],[30.3114179,59.935599],[30.3112298,59.9357255],[30.3109312,59.9359263],[30.3108416,59.9359866],[30.3105593,59.9361765],[30.3104029,59.9362817],[30.3103119,59.9363429],[30.3102313,59.9363971],[30.3101295,59.9364655],[30.3103024,59.9366458],[30.3123914,59.9373876],[30.3124162,59.9374581],[30.3126331,59.9379477],[30.3126379,59.9380088],[30.3126288,59.9380613],[30.3126137,59.9381018],[30.3125887,59.9381449],[30.3125619,59.9381783],[30.3125203,59.9382183],[30.3124762,59.9382558],[30.3124315,59.9382896],[30.309989,59.9398884],[30.3090786,59.9405117],[30.308274,59.9410565],[30.2983909,59.9374942],[30.285014,59.9338202],[30.2817969,59.9330639],[30.2773869,59.9320271],[30.2724587,59.9287347],[30.2707173,59.9256064],[30.2690368,59.9225872],[30.2677802,59.9213203],[30.2653115,59.918831],[30.2624446,59.9173952],[30.2621175,59.9173546],[30.2604927,59.9172603],[30.261523,59.9169571],[30.2620661,59.9164361],[30.2621519,59.9158408],[30.2622007,59.9136743],[30.2619127,59.912359],[30.2609047,59.9107547],[30.2599408,59.9093491],[30.2576418,59.9068884],[30.2575405,59.9067851],[30.2560605,59.9049665],[30.2559255,59.9048007],[30.2553848,59.9041362],[30.2535127,59.9026841],[30.2502783,59.9013188],[30.2502295,59.9012907]];
      //addfeature
      
        var feature = new ol.Feature({
          geometry:new ol.geom.Polygon(adddata).transform ('EPSG:4326','EPSG:3857')
        });
        heatlayer.getSource().addFeature(feature);
    
      

      var map = new ol.Map({
        layers: [raster, heatlayer],
        target: 'map',

        view: new ol.View({          
          center:[0,0],
          zoom: 2
        })
      });

      map.on('click', function(event){
        var features = heatlayer.getSource().getFeatures()
        alert('count: '+features.length);
      });
       
    </script>
  </body>
</html>